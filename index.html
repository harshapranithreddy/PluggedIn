<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Plugged In - Songbook</title>

  <meta name="theme-color" content="#160709" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <style>
    :root{
      --baseMid:#160709;

      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);

      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.12);
      --shadow:0 18px 55px rgba(0,0,0,.55);
    }

    *{ box-sizing:border-box; }
    html, body { margin:0; padding:0; }

    html{
      height:100%;
      background: var(--baseMid);
      background-color: var(--baseMid);
      color-scheme: dark;
    }

    body{
      min-height:100dvh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background: var(--baseMid);
      background-color: var(--baseMid);
      overflow-x:hidden;
      -webkit-text-size-adjust: 100%;
    }

    .bg{
      position: fixed;
      left: 0;
      right: 0;
      top: -35vh;
      bottom: -35vh;
      z-index: -2;
      pointer-events:none;

      background-color: var(--baseMid);

      background-image:
        radial-gradient(1200px 900px at 16% 18%, rgba(255,55,55,.10), transparent 62%),
        radial-gradient(1200px 900px at 86% 16%, rgba(255,90,90,.06), transparent 65%),
        radial-gradient(1400px 1100px at 50% 88%, rgba(255,55,55,.07), transparent 70%),

        radial-gradient(1400px 900px at 50% 0%, rgba(0,0,0,.22), transparent 60%),
        radial-gradient(1400px 900px at 50% 100%, rgba(0,0,0,.26), transparent 60%),

        linear-gradient(180deg, var(--baseMid) 0%, var(--baseMid) 100%);

      background-repeat: no-repeat;
      background-size: cover;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;

      padding-left: 14px;
      padding-right: 14px;

      padding-top: calc(14px + env(safe-area-inset-top));
      padding-bottom: calc(26px + env(safe-area-inset-bottom));
    }

    .topBar{
      display:flex;
      flex-direction: column;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 10px 0 14px;
      text-align:center;
    }

    .topLogo{
      height: 96px;
      width: auto;
      max-width: min(88vw, 460px);
      object-fit: contain;
      display:block;
      filter: drop-shadow(0 14px 30px rgba(0,0,0,.60));
    }

    .titleBlock h1{
      margin: 0;
      font-size: 18px;
      line-height: 1.15;
      font-weight: 900;
      letter-spacing: .2px;
    }
    .titleBlock p{
      margin: 8px 0 0;
      font-size: 13px;
      color: var(--muted);
    }

    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;

      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    @supports (-webkit-touch-callout: none) {
      .card{
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        background: rgba(18, 7, 9, .72);
      }
    }

    .searchArea{
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,60,60,.08), rgba(0,0,0,0));
    }

    .searchWrap{
      display:flex;
      gap:10px;
      align-items:center;
    }

    #searchInput{
      flex:1;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.24);
      color: var(--text);
      padding: 13px 12px;
      border-radius: 14px;
      outline:none;
      font-size: 16px;
      box-shadow: 0 10px 35px rgba(0,0,0,.28);
    }
    #searchInput:focus{
      border-color: rgba(255,60,60,.45);
      box-shadow: 0 14px 45px rgba(255,60,60,.12);
    }

    .btn{
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 11px 12px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform 120ms ease, border-color 120ms ease, background 120ms ease;
      font-size: 13px;
      flex: 0 0 auto;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.ghost{ background: transparent; }
    .btn.small{ padding: 8px 10px; border-radius: 12px; font-size: 12px; }

    .metaRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 14px 12px;
    }
    .muted{ color: var(--muted); }

    .pill{
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      font-size: 12px;
      white-space: nowrap;
    }

    .resultsMeta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 14px;
      margin: 0 14px 10px;
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: 16px;
    }
    .hidden{ display:none; }

    .songList{
      list-style:none;
      margin: 0;
      padding: 0 12px 12px;
      display:grid;
      gap: 10px;
    }

    .songItem{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      cursor:pointer;
      transition: transform 120ms ease, border-color 120ms ease, background 120ms ease;
      -webkit-tap-highlight-color: transparent;
    }
    .songItem:hover{
      border-color: rgba(255,60,60,.25);
      background: rgba(255,60,60,.06);
      transform: translateY(-1px);
    }
    .songItem:active{ transform: translateY(0px) scale(.995); }

    .songLeft{ display:flex; gap:12px; align-items:center; min-width:0; }
    .songNum{
      width: 34px; height: 34px;
      border-radius: 12px;
      display:grid; place-items:center;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(135deg, rgba(255,60,60,.18), rgba(0,0,0,.18));
      color: rgba(255,255,255,.84);
      font-size: 12px;
      flex: 0 0 auto;
    }
    .songText{ min-width:0; }
    .songTitle{
      font-weight: 900;
      font-size: 15px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .songArtist{
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .chev{ color: rgba(255,255,255,.55); font-size: 22px; line-height: 1; }

    mark{
      background: rgba(255,60,60,.18);
      color: var(--text);
      padding: 0 2px;
      border-radius: 6px;
    }

    .detailTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,60,60,.08), rgba(0,0,0,0));
    }

    .detailHeader{ padding: 12px 14px 0; }
    .detailHeader h2{
      margin: 6px 0 0;
      font-size: 20px;
      line-height: 1.2;
      font-weight: 900;
    }
    .detailHeader p{ margin: 8px 0 10px; }

    .lyricsBox{
      margin: 0 14px 14px;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      background: rgba(0,0,0,.22);
      padding: 14px;
      overflow:hidden;
    }
    .lyrics{
      margin:0;
      white-space: pre-wrap;
      line-height: 1.6;
      font-size: 14px;
      color: rgba(255,255,255,.88);
    }
    .lyricsFallback{ padding: 8px 2px; }
    .lyricsFallback h3{ margin:0 0 6px; font-size: 16px; }
    .lyricsFallback p{ margin:0; }

    /* Scroll to top button */
    .toTop{
      position: fixed;
      right: calc(14px + env(safe-area-inset-right));
      bottom: calc(14px + env(safe-area-inset-bottom));
      z-index: 999;
    
      width: 38px;
      height: 38px;
      border-radius: 999px;
    
      display: grid;
      place-items: center;
    
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.28);
      color: rgba(255,255,255,.85);
    
      box-shadow: 0 14px 40px rgba(0,0,0,.45);
      -webkit-tap-highlight-color: transparent;
    
      /* smooth show/hide */
      opacity: 0;
      transform: translate3d(0,10px,0) scale(.96);
      visibility: hidden;
      pointer-events: none;
    
      transition:
        opacity 220ms ease,
        transform 220ms ease,
        visibility 0s linear 220ms; /* delay visibility flip until fade out ends */
    
      will-change: opacity, transform;
    }
    
    .toTop.show{
      opacity: .92;
      transform: translate3d(0,0,0) scale(1);
      visibility: visible;
      pointer-events: auto;
    
      transition:
        opacity 220ms ease,
        transform 220ms ease,
        visibility 0s; /* show immediately */
    }
    
    /* icon */
    .toTopIcon{
      width: 22px;
      height: 22px;
      display:block;
    }
    .toTop.show{
      opacity: .9;
      transform: translateY(0);
      pointer-events: auto;
    }

    .toTop:active{
      transform: translateY(1px) scale(.98);
    }

    @media (hover:hover){
      .toTop:hover{
        border-color: rgba(255,60,60,.28);
        background: rgba(255,60,60,.10);
      }
    }

    .footer{
      text-align:center;
      padding: 14px 6px 0;
      font-size: 12px;
      color: var(--muted);
    }

    @media (min-width: 720px){
      .wrap{
        padding-left: 18px;
        padding-right: 18px;
        padding-top: calc(18px + env(safe-area-inset-top));
        padding-bottom: calc(34px + env(safe-area-inset-bottom));
      }
      .topLogo{ height: 110px; max-width: 520px; }
      .titleBlock h1{ font-size: 20px; }
      #searchInput{ font-size: 16px; }
      .songTitle{ font-size: 16px; }
    }
  </style>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>

  <div class="wrap">
    <div class="topBar">
      <img class="topLogo" src="./main/ba.png" alt="Plugged In logo" />
      <div class="titleBlock">
        <h1>Plugged In Songbook</h1>
        <p>Search the setlist. Tap a song for lyrics.</p>
      </div>
    </div>

    <main class="card">
      <div class="searchArea">
        <div class="searchWrap">
          <input id="searchInput" type="search" placeholder="Search from the setlist…" autocomplete="off" />
          <button id="clearBtn" class="btn ghost" type="button" aria-label="Clear search">Clear</button>
        </div>
      </div>

      <section id="listView">
        <div class="metaRow">
          <div>
            <div style="font-weight:900; font-size:14px;">Setlist</div>
            <div class="muted" id="countText" style="font-size:12px; margin-top:4px;">Loading songs…</div>
          </div>
          <div class="pill">Search enabled</div>
        </div>

        <div id="resultsMeta" class="resultsMeta hidden">
          <span id="resultsText" class="muted" style="font-size:12px;"></span>
          <button id="showAllBtn" class="btn small" type="button">Show all</button>
        </div>

        <ul id="songList" class="songList"></ul>

        <div id="noResults" class="hidden" style="padding: 18px 14px 20px; text-align:center;">
          <div style="font-weight:900; font-size:16px; margin-bottom:6px;">No matches</div>
          <div class="muted" style="font-size:12px; margin-bottom:12px;">Try a different spelling or tap Show all.</div>
          <button id="showAllBtn2" class="btn" type="button">Show all songs</button>
        </div>
      </section>

      <section id="detailView" class="hidden">
        <div class="detailTop">
          <button id="backBtn" class="btn ghost" type="button">← Back</button>
          <div class="pill" id="songNumberPill"></div>
        </div>

        <div class="detailHeader">
          <h2 id="songTitle">Song Title</h2>
          <p class="muted" id="songArtist">Artist</p>
        </div>

        <article class="lyricsBox">
          <pre id="lyricsText" class="lyrics"></pre>
          <div id="lyricsFallback" class="lyricsFallback hidden"></div>
        </article>
      </section>
    </main>

    <div class="footer">Built by XTSY Productions</div>
  </div>

  <!-- ✅ Button MUST be HTML (not inside <script>) -->
  <button id="toTopBtn" class="toTop" type="button" aria-label="Scroll to top" title="Back to top">
    <svg class="toTopIcon" viewBox="0 0 64 64" aria-hidden="true" focusable="false">
      <path d="M20 38 L32 26 L44 38"
        fill="none"
        stroke="currentColor"
        stroke-width="7"
        stroke-linecap="round"
        stroke-linejoin="round"/>
    </svg>
  </button>

  <script>
    const SONGS = [
      { id: 1, title: "O Sakkanoda", artist: "Dhee", lyrics: "" },
      { id: 2, title: "Rangamma Mangamma", artist: "M. M. Manasi", lyrics: "" },
      { id: 3, title: "Barso Re", artist: "Shreya Ghoshal, Uday Mazumdar", lyrics: "" },
      { id: 4, title: "Nanne Nanne Chusthu", artist: "Tippu, Pop Shalini", lyrics: "" },
      { id: 5, title: "Chiru Chiru", artist: "", lyrics: "" },
      { id: 6, title: "Zara Zara", artist: "Bombay Jayashri", lyrics: "" },
      { id: 7, title: "Vaseegara", artist: "Bombay Jayashri", lyrics: "" },
      { id: 8, title: "Manohara", artist: "", lyrics: "" },
      { id: 9, title: "Konte Choopu", artist: "", lyrics: "" },
      { id: 10, title: "Maahi Ve", artist: "", lyrics: "" },
      { id: 11, title: "Sirivennela", artist: "", lyrics: "" },
      { id: 12, title: "Haule Haule", artist: "Sukhwinder Singh", lyrics: "" },
      { id: 13, title: "Lag Ja Gale", artist: "Lata Mangeshkar", lyrics: "" },
      { id: 14, title: "Vintunnavaa", artist: "Shreya Ghoshal, Karthik", lyrics: "" },
      { id: 15, title: "Kannazhaga", artist: "Dhanush, Shruti Haasan", lyrics: "" },
      { id: 16, title: "Tera Hone Laga Hoon", artist: "Atif Aslam, Alisha Chinai", lyrics: "" },
      { id: 17, title: "Te Amo", artist: "Ash King, Sunidhi Chauhan", lyrics: "" },
      { id: 18, title: "Nuvvunte Chaley", artist: "", lyrics: "" },
      { id: 19, title: "Na Cheli Rojave", artist: "", lyrics: "" },
      { id: 20, title: "Kailove Chedugudu", artist: "", lyrics: "" },
      { id: 21, title: "Hello Rammante", artist: "", lyrics: "" },
      { id: 22, title: "Kya Mujhe Pyaar Hai", artist: "", lyrics: "" },
      { id: 23, title: "Cheliya Cheliya", artist: "", lyrics: "" },
      { id: 24, title: "Telusa Manasa", artist: "", lyrics: "" },
      { id: 25, title: "Oka Maaru", artist: "", lyrics: "" },
      { id: 26, title: "Hosanna", artist: "Vijay Prakash, Suzanne D’Mello, Blaaze", lyrics: "" },
      { id: 27, title: "Malare", artist: "", lyrics: "" },
      { id: 28, title: "My Heart Is Beating", artist: "", lyrics: "" },
      { id: 29, title: "Mayya Jinna Sona", artist: "", lyrics: "" },
      { id: 30, title: "Jabilli Kosam", artist: "", lyrics: "" },
      { id: 31, title: "Hello Guru Prema Kosame", artist: "", lyrics: "" },
      { id: 32, title: "O Prema (Vasu)", artist: "", lyrics: "" },
      { id: 33, title: "Paataku Pranam", artist: "", lyrics: "" },
      { id: 34, title: "Madhuvarame", artist: "", lyrics: "" },
      { id: 35, title: "Khwaja Mere Khwaja", artist: "", lyrics: "" },
      { id: 36, title: "Tum Hi Ho", artist: "Arijit Singh", lyrics: "" },
      { id: 37, title: "Enno Raatrulosthayi", artist: "", lyrics: "" },
      { id: 38, title: "Pehla Nasha", artist: "Udit Narayan, Sadhana Sargam", lyrics: "" },
      { id: 39, title: "Kadalalle", artist: "", lyrics: "" },
      { id: 40, title: "Mere Sapnon Ki Rani", artist: "", lyrics: "" },
      { id: 41, title: "Suthi Suthi", artist: "", lyrics: "" },
      { id: 42, title: "Andhama Andhuma", artist: "", lyrics: "" },
      { id: 43, title: "Pottala Muttaye", artist: "", lyrics: "" },
      { id: 44, title: "Subhalekha", artist: "", lyrics: "" },
      { id: 45, title: "Bhoomi Enna Suthudhe", artist: "", lyrics: "" },
      { id: 46, title: "Udhungada Sangu", artist: "", lyrics: "" },
      { id: 47, title: "Jaamu Raathiri", artist: "", lyrics: "" },
      { id: 48, title: "Gehra Hua", artist: "", lyrics: "" },
      { id: 49, title: "Bommanu Geesthey", artist: "", lyrics: "" },
      { id: 50, title: "Thangamey", artist: "", lyrics: "" },
    ];

    const el = (id) => document.getElementById(id);

    const searchInput = el("searchInput");
    const clearBtn = el("clearBtn");

    const listView = el("listView");
    const detailView = el("detailView");

    const songList = el("songList");
    const countText = el("countText");

    const resultsMeta = el("resultsMeta");
    const resultsText = el("resultsText");
    const showAllBtn = el("showAllBtn");
    const showAllBtn2 = el("showAllBtn2");
    const noResults = el("noResults");

    const backBtn = el("backBtn");
    const songNumberPill = el("songNumberPill");
    const songTitle = el("songTitle");
    const songArtist = el("songArtist");
    const lyricsText = el("lyricsText");
    const lyricsFallback = el("lyricsFallback");

    const toTopBtn = el("toTopBtn");

    // ✅ NEW: remember where the list was scrolled to
    let listScrollY = 0;

    function normalize(str) {
      return (str || "")
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
    }

    function escapeRegExp(s) {
      return s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    }

    function escapeHtml(s) {
      return (s || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function highlight(text, query) {
      if (!query) return escapeHtml(text);
      const safe = escapeHtml(text);
      const q = escapeRegExp(query);
      return safe.replace(new RegExp(`(${q})`, "ig"), "<mark>$1</mark>");
    }

    function renderList(songs, query = "") {
      songList.innerHTML = "";
      countText.textContent = `${songs.length} song${songs.length === 1 ? "" : "s"} showing`;

      if (query) {
        resultsMeta.classList.remove("hidden");
        resultsText.textContent = `Results for ${query}`;
      } else {
        resultsMeta.classList.add("hidden");
        resultsText.textContent = "";
      }

      if (!songs.length) {
        noResults.classList.remove("hidden");
        return;
      }
      noResults.classList.add("hidden");

      for (const s of songs) {
        const li = document.createElement("li");
        li.className = "songItem";
        li.setAttribute("role", "button");
        li.tabIndex = 0;

        li.innerHTML = `
          <div class="songLeft">
            <div class="songNum">${s.id}</div>
            <div class="songText">
              <div class="songTitle">${highlight(s.title, query)}</div>
              <div class="songArtist">${highlight(s.artist || "", query)}</div>
            </div>
          </div>
          <div class="chev">›</div>
        `;

        li.addEventListener("click", () => openSong(s.id));
        li.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") openSong(s.id);
        });

        songList.appendChild(li);
      }
    }

    function openSong(id) {
      const song = SONGS.find((s) => s.id === id);
      if (!song) return;

      // ✅ NEW: save current scroll position BEFORE switching views
      listScrollY = getScrollTop();

      songNumberPill.textContent = `Song #${song.id}`;
      songTitle.textContent = song.title;
      songArtist.textContent = song.artist || "";

      lyricsText.textContent = "";
      lyricsFallback.classList.add("hidden");
      lyricsFallback.innerHTML = "";

      const hasInlineLyrics = normalize(song.lyrics).length > 0;

      if (hasInlineLyrics) {
        lyricsText.textContent = song.lyrics;
      } else {
        lyricsFallback.classList.remove("hidden");
        lyricsFallback.innerHTML = `
          <h3>Lyrics</h3>
          <p class="muted">Paste lyrics here</p>
        `;
      }

      listView.classList.add("hidden");
      detailView.classList.remove("hidden");

      // Optional: keep this to show lyrics from top
      window.scrollTo({ top: 0, behavior: "smooth" });

      updateToTopBtn();
    }

    function goBackToList() {
      detailView.classList.add("hidden");
      listView.classList.remove("hidden");

      // ✅ NEW: restore scroll position (so you go back to song 23 area)
      // Use rAF so the browser paints the list view first, then scrolls.
      requestAnimationFrame(() => {
        window.scrollTo({ top: listScrollY, behavior: "auto" });
        updateToTopBtn();
      });
    }

    function filterSongs(queryRaw) {
      const query = normalize(queryRaw);
      if (!query) return { query: "", results: SONGS };

      const results = SONGS.filter((s) => {
        const hay = normalize(`${s.title} ${s.artist || ""}`);
        return hay.includes(query);
      });

      return { query: queryRaw.trim(), results };
    }

    function clearSearch() {
      searchInput.value = "";
      renderList(SONGS, "");
      searchInput.focus();
    }

    searchInput.addEventListener("input", (e) => {
      const { query, results } = filterSongs(e.target.value);
      renderList(results, query);
    });

    clearBtn.addEventListener("click", clearSearch);
    showAllBtn.addEventListener("click", clearSearch);
    showAllBtn2.addEventListener("click", clearSearch);

    backBtn.addEventListener("click", goBackToList);

    document.addEventListener("keydown", (e) => {
      if (e.key !== "Escape") return;

      const detailOpen = !detailView.classList.contains("hidden");
      if (detailOpen) goBackToList();
      else clearSearch();
    });

    // Scroll-to-top logic (works for window scrolling)
    function getScrollTop(){
      return window.scrollY || document.documentElement.scrollTop || 0;
    }

    function scrollToTop(){
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function updateToTopBtn(){
      const y = getScrollTop();
      if (y > 220) toTopBtn.classList.add("show");
      else toTopBtn.classList.remove("show");
    }

    toTopBtn.addEventListener("click", scrollToTop);
    window.addEventListener("scroll", updateToTopBtn, { passive: true });

    // Initial render
    renderList(SONGS, "");
    updateToTopBtn();
  </script>
</body>
</html>
